names_tib <-
babynames |>
filter(name |> str_detect("^Kr")) |>
select(-prop) |>
group_by(year, name, sex) |>
summarize(n = sum(n))
names_tib
babynames |>
filter(name |> str_detect("^Kr")) |>
select(-prop) |>
group_by(year, name, sex) |>
summarize(n = sum(n), .groups = c(year,name))
babynames |>
filter(name |> str_detect("^Kr")) |>
select(-prop) |>
group_by(year, name, sex) |>
summarize(n = sum(n), .groups = c("year","name"))
# Rows: 1,924,665
# Columns: 5
# $ year <dbl> 1880, 1880, 1880, 1880, 1880, 1880, 1880, 1880, 188…
# $ sex  <chr> "F", "F", "F", "F", "F", "F", "F", "F", "F", "F", "…
# $ name <chr> "Mary", "Anna", "Emma", "Elizabeth", "Minnie", "Mar…
# $ n    <int> 7065, 2604, 2003, 1939, 1746, 1578, 1472, 1414, 132…
# $ prop <dbl> 0.07238359, 0.02667896, 0.02052149, 0.01986579, 0.0…
# >
# Group by year, and work with that tibble
names_tib <-
babynames |>
filter(name |> str_detect("^Kr")) |>
select(-prop) |>
group_by(year, name, sex) |>
summarize(n = sum(n))
names_tib
# # A tibble: 6,212 × 4
# # Groups:   year, name [5,547]
#    year name     sex       n
#    <dbl> <chr>    <chr> <int>
# 1  1915 Kristina F         5
# 2  1916 Kramer   M         5
# 3  1916 Kristine F         6
# 4  1917 Kristine F         8
# ...
# Number of names shared by M & F:
6212 - 5547
# Rows: 1,924,665
# Columns: 5
# $ year <dbl> 1880, 1880, 1880, 1880, 1880, 1880, 1880, 1880, 188…
# $ sex  <chr> "F", "F", "F", "F", "F", "F", "F", "F", "F", "F", "…
# $ name <chr> "Mary", "Anna", "Emma", "Elizabeth", "Minnie", "Mar…
# $ n    <int> 7065, 2604, 2003, 1939, 1746, 1578, 1472, 1414, 132…
# $ prop <dbl> 0.07238359, 0.02667896, 0.02052149, 0.01986579, 0.0…
# >
# Group by year, and work with that tibble
names_tib <-
babynames |>
filter(name |> str_detect("^Kr")) |>
select(-prop) |>
group_by(year, name, sex) |>
summarize(n = sum(n)) |>
ungroup()
names_tib
# [1] 665
# >
# For a particular year and name, nest sex and n:
names_tib_nested <-
names_tib |>
nest(data = C(sex, n))
# [1] 665
# >
# For a particular year and name, nest sex and n:
names_tib_nested <-
names_tib |>
tidyr::nest(.data = C(sex, n))
# [1] 665
# >
# For a particular year and name, nest sex and n:
names_tib_nested <-
names_tib |>
tidyr::nest(.data = C("sex", "n"))
# [1] 665
# >
# For a particular year and name, nest sex and n:
names_tib_nested <-
names_tib |>
tidyr::nest(.data = C("sex", "n"))
# [1] 665
# >
# For a particular year and name, nest sex and n:
names_tib_nested <-
names_tib |>
tidyr::nest(.data = c("sex", "n"))
# [1] 665
# >
# For a particular year and name, nest sex and n:
names_tib_nested <-
names_tib |>
tidyr::nest(.data = c(sex, n))
# [1] 665
# >
# For a particular year and name, nest sex and n:
names_tib_nested <-
names_tib |>
tidyr::nest(data = c(sex, n))
2+3
names_tib_nested
babynames %>%
filter(grepl("^Kr", name)) %>%
group_by(year, name) %>%
tally(wt=n)
babynames |>
filter(name |> str_detect("^Kr")) |>
summarize(total = sum(n), .by = c(name)) |>
arrange(total |> desc())
babynames |>
filter(name |> str_detect("^Kr")) |>
summarize(total = sum(n), .by = c(sex,name)) |>
arrange(total |> desc())
#   7  1920 Kristina <tibble [1 × 2]>
#   8  1920 Kristine <tibble [1 × 2]>
#   9  1921 Kristina <tibble [1 × 2]>
#  10  1921 Kristine <tibble [1 × 2]>
#   # ℹ 5,537 more rows
#   # ℹ Use `print(n = ...)` to see more rows
#   >
#
# WAIT! We want the sum over all years! RESTART!! --------------
# From L49
names_tib <-
babynames |>
filter(name |> str_detect("^Kr")) |>
summarize(total = sum(n), .by = c(sex,name)) |>
arrange(total |> desc())
names_tib
names_tib |> tidyr::nest(data = c(sex,name))
names_tib |>
tidyr::nest(data = c(sex,name)) |>
filter(nrow(data[[1]] == 1))
names_tib |>
tidyr::nest(data = c(sex,name)) |>
filter(nrow(data[[1]]) == 1)
names_tib |>
tidyr::nest(data = c(sex,name)) |>
filter(nrow(data[[1]]) == 2)
names_tib |>
arrange(sex)
names_tib |>
arrange(sex |> desc())
names_tib |>
filter(name == "Kris")
names_tib |>
tidyr::nest(data = c(sex,total))
names_tib_nested <-
names_tib |>
tidyr::nest(data = c(sex,total))
names_tib_nested
names_tib_nested |>
mutate(len = nrow(data[[1]]))
names_tib_nested |>
mutate(len = nrow(data[[1]])) |>
distinct(len)
# # A tibble: 1 × 1
#        len
#        <int>
#  1     2
# >
#
names_tib_nested |> first()
# # A tibble: 1 × 1
#        len
#        <int>
#  1     2
# >
#
names_tib_nested |> first() |> select(data)
source("~/work_streamgraph_pkg.R", echo=TRUE)
library(tidyverse) # includes `tidyr`
library(babynames)
library(streamgraph)
#   7  1920 Kristina <tibble [1 × 2]>
#   8  1920 Kristine <tibble [1 × 2]>
#   9  1921 Kristina <tibble [1 × 2]>
#  10  1921 Kristine <tibble [1 × 2]>
#   # ℹ 5,537 more rows
#   # ℹ Use `print(n = ...)` to see more rows
#   >
#
# WAIT! We want the sum over all years! RESTART!! --------------
# From L49
names_tib <-
babynames |>
filter(name |> str_detect("^Kr")) |>
summarize(total = sum(n), .by = c(sex,name)) |>
arrange(total |> desc())
#
names_tib
names_tib |>
tidyr::nest(data = c(sex,name)) |>
filter(nrow(data[[1]]) == 2)
names_tib |>
arrange(sex |> desc())
names_tib |>
filter(name == "Kris")
names_tib_nested <-
names_tib |>
tidyr::nest(data = c(sex,total))
names_tib_nested
names_tib_nested |>
mutate(len = nrow(data[[1]])) |>
distinct(len)
# # A tibble: 1 × 1
#        len
#        <int>
#  1     2
# >
#
names_tib_nested |> first() |> select(data) |> magrittr::extract2(1)
# How about PIVOT WIDER??????????
names_tib
names_tib |> glimpse()
# Rows: 380
# Columns: 3
# $ sex   <chr> "F", "F", "F", "F", "F", "F", "F", "F", "M", "F", …
# $ name  <chr> "Kristen", "Kristin", "Kristina", "Kristine", "Kri…
# $ total <int> 217598, 178972, 135415, 83908, 76375, 74191, 73286…
# >
#
names_tib |>
pivot_wider(names_from = sex, values_from = total)
# Rows: 380
# Columns: 3
# $ sex   <chr> "F", "F", "F", "F", "F", "F", "F", "F", "M", "F", …
# $ name  <chr> "Kristen", "Kristin", "Kristina", "Kristine", "Kri…
# $ total <int> 217598, 178972, 135415, 83908, 76375, 74191, 73286…
# >
#
names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(n = total)
# Rows: 380
# Columns: 3
# $ sex   <chr> "F", "F", "F", "F", "F", "F", "F", "F", "M", "F", …
# $ name  <chr> "Kristen", "Kristin", "Kristina", "Kristine", "Kri…
# $ total <int> 217598, 178972, 135415, 83908, 76375, 74191, 73286…
# >
#
names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(total = n)
names_tib |>
pivot_wider(names_from = sex, values_from = total)
# Rows: 380
# Columns: 3
# $ sex   <chr> "F", "F", "F", "F", "F", "F", "F", "F", "M", "F", …
# $ name  <chr> "Kristen", "Kristin", "Kristina", "Kristine", "Kri…
# $ total <int> 217598, 178972, 135415, 83908, 76375, 74191, 73286…
# >
#
names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
mutate(total = F + M)
names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(Female = F)
names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(Female = "F", Male = M)
# Rows: 380
# Columns: 3
# $ sex   <chr> "F", "F", "F", "F", "F", "F", "F", "F", "M", "F", …
# $ name  <chr> "Kristen", "Kristin", "Kristina", "Kristine", "Kri…
# $ total <int> 217598, 178972, 135415, 83908, 76375, 74191, 73286…
# >
#
names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(Female = "F", Male = M) |>
mutate(total = Female + Male)
# Rows: 380
# Columns: 3
# $ sex   <chr> "F", "F", "F", "F", "F", "F", "F", "F", "M", "F", …
# $ name  <chr> "Kristen", "Kristin", "Kristina", "Kristine", "Kri…
# $ total <int> 217598, 178972, 135415, 83908, 76375, 74191, 73286…
# >
#
tib <- names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(Female = "F", Male = M) |>
mutate(total = Female + Male)
tib |>
filter(Female == 0 | Male == 0)
tib |>
filter(Female == 0 | Male == 0)
tib |>
filter(Female == 0)
tib |>
filter(Female <= 10)
# Rows: 380
# Columns: 3
# $ sex   <chr> "F", "F", "F", "F", "F", "F", "F", "F", "M", "F", …
# $ name  <chr> "Kristen", "Kristin", "Kristina", "Kristine", "Kri…
# $ total <int> 217598, 178972, 135415, 83908, 76375, 74191, 73286…
# >
#
tib <- names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(Female = "F", Male = M) |>
mutate(total = Female + Male) |>
replace_na(0)
tib |>
filter(Female <= 10)
# Rows: 380
# Columns: 3
# $ sex   <chr> "F", "F", "F", "F", "F", "F", "F", "F", "M", "F", …
# $ name  <chr> "Kristen", "Kristin", "Kristina", "Kristine", "Kri…
# $ total <int> 217598, 178972, 135415, 83908, 76375, 74191, 73286…
# >
#
tib <- names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(Female = "F", Male = M) |>
mutate(total = Female + Male) |>
replace_na(Male = 0)
# Rows: 380
# Columns: 3
# $ sex   <chr> "F", "F", "F", "F", "F", "F", "F", "F", "M", "F", …
# $ name  <chr> "Kristen", "Kristin", "Kristina", "Kristine", "Kri…
# $ total <int> 217598, 178972, 135415, 83908, 76375, 74191, 73286…
# >
#
tib <- names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(Female = "F", Male = M) |>
mutate(total = Female + Male) |>
replace_na(list(Male = 0))
tib |>
filter(Female <= 10)
# Rows: 380
# Columns: 3
# $ sex   <chr> "F", "F", "F", "F", "F", "F", "F", "F", "M", "F", …
# $ name  <chr> "Kristen", "Kristin", "Kristina", "Kristine", "Kri…
# $ total <int> 217598, 178972, 135415, 83908, 76375, 74191, 73286…
# >
#
tib <- names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(Female = "F", Male = M) |>
replace_na(list(Male = 0, Female = 0)) |>
mutate(total = Female + Male)
tib |>
filter(Female <= 10)
tib |>
filter(Female == 0)
tib |>
filter(Female == 0 | Male == 0)
names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(Female = "F", Male = M) |>
replace_na(c(Male = 0, Female = 0)) |>
mutate(total = Female + Male)
names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(Female = "F", Male = M) |>
replace_na(list(Male = 0, Female = 0)) |>
mutate(total = Female + Male)
library(tidyverse) # includes `tidyr`
library(babynames)
library(streamgraph)
# How about PIVOT WIDER?????????? ------------------
# Redefine `names_tib`
names_tib <-
babynames |>
filter(name |> str_detect("^Kr")) |>
summarize(total = sum(n), .by = c(sex,name)) |>
arrange(total |> desc())
names_tib |> glimpse()
# Rows: 380
# Columns: 3
# $ sex   <chr> "F", "F", "F", "F", "F", "F", "F", "F", "M", "F", …
# $ name  <chr> "Kristen", "Kristin", "Kristina", "Kristine", "Kri…
# $ total <int> 217598, 178972, 135415, 83908, 76375, 74191, 73286…
# >
#
tib <- names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(Female = "F", Male = M) |>
replace_na(list(Male = 0, Female = 0)) |>
mutate(total = Female + Male)
tib
tib |>
filter(Female == 0 | Male == 0)
tib |>
filter(Female == 0 | Male == 0) |> nrow()
# [1] 306
tib |>
filter(Female == 0) |> nrow()
# [1] 100
tib |>
filter(Male == 0) |> nrow()
# Rows: 380
# Columns: 3
# $ sex   <chr> "F", "F", "F", "F", "F", "F", "F", "F", "M", "F", …
# $ name  <chr> "Kristen", "Kristin", "Kristina", "Kristine", "Kri…
# $ total <int> 217598, 178972, 135415, 83908, 76375, 74191, 73286…
# >
# To get the totals, male and female, for each name: `pivot_wider()`
tib <- names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(female = "F", male = M) |>
replace_na(list(Male = 0, Female = 0)) |>
mutate(total = Female + Male)
tib
# Rows: 380
# Columns: 3
# $ sex   <chr> "F", "F", "F", "F", "F", "F", "F", "F", "M", "F", …
# $ name  <chr> "Kristen", "Kristin", "Kristina", "Kristine", "Kri…
# $ total <int> 217598, 178972, 135415, 83908, 76375, 74191, 73286…
# >
# To get the totals, male and female, for each name: `pivot_wider()`
tib <- names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(female = "F", male = M) |>
replace_na(list(male = 0, female = 0)) |>
mutate(total = female + male)
tib
# [1] 100
tib |>
filter(male == 0) |> nrow()
# Rows: 380
# Columns: 3
# $ sex   <chr> "F", "F", "F", "F", "F", "F", "F", "F", "M", "F", …
# $ name  <chr> "Kristen", "Kristin", "Kristina", "Kristine", "Kri…
# $ total <int> 217598, 178972, 135415, 83908, 76375, 74191, 73286…
# >
# To get the totals, male and female, for each name: `pivot_wider()`
tib <- names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(female = "F", male = "M") |>
replace_na(list(male = 0, female = 0)) |>
mutate(total = female + male)
tib
tib |>
filter(female == 0 | male == 0) |> nrow()
# [1] 306
tib |>
filter(female == 0) |> nrow()
# [1] 100
tib |>
filter(male == 0) |> nrow()
# Rows: 380
# Columns: 3
# $ sex   <chr> "F", "F", "F", "F", "F", "F", "F", "F", "M", "F", …
# $ name  <chr> "Kristen", "Kristin", "Kristina", "Kristine", "Kri…
# $ total <int> 217598, 178972, 135415, 83908, 76375, 74191, 73286…
# >
# To get the totals, male and female, for each name: `pivot_wider()`
tib_wide <- names_tib |>
pivot_wider(names_from = sex, values_from = total) |>
rename(female = "F", male = "M") |>
replace_na(list(male = 0, female = 0)) |>
mutate(total = female + male)
tib_wide
tib_wide |>
filter(female == 0 | male == 0) |> nrow()
# [1] 306
tib_wide |>
filter(female == 0) |> nrow()
# [1] 100
tib_wide |>
filter(male == 0) |> nrow()
tib_long <- tib_wide |>
pivot_longer(cols = c(female, male))
tib_long <- tib_wide |>
pivot_longer(
cols = c(female, male),
names_to = "sex")
tib_long
tib_wide |>
pivot_longer(
cols = c(female, male),
names_to = "sex",
values_to = "n")
tib_wide |>
pivot_longer(
cols = c(female, male),
names_to = "sex",
values_to = "n") |>
rename(total_mf=total)
tib_long <- tib_wide |>
pivot_longer(
cols = c(female, male),
names_to = "sex",
values_to = "n")
tib_long
tib_long |> arrange(n |> desc())
#  5 Kristi      76513 female  76375
#  6 Krystal     74381 female  74191
#  7 Krista      73434 female  73286
#  8 Kristy      70450 female  70271
#  9 Kristopher  61591 male    61294
# 10 Kristie     38333 female  38289
# # ℹ 676 more rows
# >
# Females are more concentrated in fewer names.
#
tib_long |> row_number()
tib_long |> arrange(n |> desc()) |> row_number()
(tib_long |> arrange(n |> desc()))[20]
(tib_long |> arrange(n |> desc()))[20,]
names_tib
(tib_long |> arrange(n |> desc()))[20,]
setwd("~/websites/blog")
getwd()
